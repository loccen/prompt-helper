<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prompt-Helper 测试体系架构</title>
    <style>
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            background-color: #f5f5f5;
            margin: 0;
            padding: 20px;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1, h2 {
            color: #333;
            text-align: center;
        }
        .pyramid-container {
            display: flex;
            justify-content: center;
            margin: 40px 0;
        }
        .pyramid {
            width: 600px;
            height: 400px;
            position: relative;
        }
        .layer {
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(to right, rgba(41, 128, 185, 0.9), rgba(52, 152, 219, 0.9));
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            text-align: center;
            padding: 10px;
            box-sizing: border-box;
        }
        .layer-1 {
            bottom: 0;
            width: 100%;
            height: 40%;
        }
        .layer-2 {
            bottom: 40%;
            width: 75%;
            height: 30%;
            background: linear-gradient(to right, rgba(41, 128, 185, 0.8), rgba(52, 152, 219, 0.8));
        }
        .layer-3 {
            bottom: 70%;
            width: 50%;
            height: 20%;
            background: linear-gradient(to right, rgba(41, 128, 185, 0.7), rgba(52, 152, 219, 0.7));
        }
        .layer-4 {
            bottom: 90%;
            width: 25%;
            height: 10%;
            background: linear-gradient(to right, rgba(41, 128, 185, 0.6), rgba(52, 152, 219, 0.6));
        }
        .annotations {
            position: absolute;
            width: 100%;
        }
        .annotation {
            position: absolute;
            width: 200px;
            padding: 10px;
            background: white;
            border-radius: 4px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            font-size: 14px;
        }
        .annotation-1 {
            bottom: 10%;
            left: -220px;
        }
        .annotation-2 {
            bottom: 50%;
            left: -220px;
        }
        .annotation-3 {
            bottom: 75%;
            right: -220px;
        }
        .annotation-4 {
            bottom: 90%;
            right: -220px;
        }
        .arrow {
            position: absolute;
            width: 20px;
            height: 2px;
            background: #333;
        }
        .arrow-1 {
            bottom: 20%;
            left: -20px;
            width: 20px;
        }
        .arrow-2 {
            bottom: 55%;
            left: -20px;
            width: 20px;
        }
        .arrow-3 {
            bottom: 80%;
            right: -20px;
            width: 20px;
        }
        .arrow-4 {
            bottom: 95%;
            right: -20px;
            width: 20px;
        }
        .arrow::after {
            content: '';
            position: absolute;
            right: 0;
            top: -3px;
            width: 0;
            height: 0;
            border-top: 4px solid transparent;
            border-bottom: 4px solid transparent;
            border-left: 6px solid #333;
        }
        .arrow-3::after, .arrow-4::after {
            left: 0;
            right: auto;
            border-left: none;
            border-right: 6px solid #333;
        }
        
        .test-structure {
            margin-top: 60px;
        }
        .test-structure h2 {
            margin-bottom: 30px;
        }
        .structure-diagram {
            display: flex;
            justify-content: center;
        }
        .modules {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            margin-top: 40px;
        }
        .module {
            width: 200px;
            min-height: 120px;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            background: white;
            text-align: center;
        }
        .module h3 {
            margin-top: 0;
            color: #2980b9;
        }
        .module ul {
            text-align: left;
            padding-left: 20px;
        }
        .coverage {
            margin-top: 10px;
            font-size: 12px;
            color: #666;
        }
        .tree-diagram {
            width: 80%;
            margin: 0 auto;
            position: relative;
        }
        .node {
            padding: 10px 15px;
            background: #3498db;
            color: white;
            border-radius: 4px;
            display: inline-block;
        }
        .lines {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            pointer-events: none;
        }
        .legend {
            margin-top: 40px;
            display: flex;
            justify-content: center;
            gap: 20px;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
        }
        .legend-color-1 {
            background: linear-gradient(to right, rgba(41, 128, 185, 0.9), rgba(52, 152, 219, 0.9));
        }
        .legend-color-2 {
            background: linear-gradient(to right, rgba(41, 128, 185, 0.8), rgba(52, 152, 219, 0.8));
        }
        .legend-color-3 {
            background: linear-gradient(to right, rgba(41, 128, 185, 0.7), rgba(52, 152, 219, 0.7));
        }
        .legend-color-4 {
            background: linear-gradient(to right, rgba(41, 128, 185, 0.6), rgba(52, 152, 219, 0.6));
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Prompt-Helper 测试体系架构</h1>
        
        <div class="pyramid-container">
            <div class="pyramid">
                <div class="layer layer-1">
                    <div>
                        <h3>单元测试</h3>
                        <p>核心服务、组件、工具函数<br>覆盖率 ≥ 90%</p>
                    </div>
                </div>
                <div class="layer layer-2">
                    <div>
                        <h3>集成测试</h3>
                        <p>组件交互、服务协作<br>覆盖率 ≥ 80%</p>
                    </div>
                </div>
                <div class="layer layer-3">
                    <div>
                        <h3>端到端测试</h3>
                        <p>完整用户场景<br>覆盖率 ≥ 70%</p>
                    </div>
                </div>
                <div class="layer layer-4">
                    <div>
                        <h3>性能测试</h3>
                    </div>
                </div>
                
                <div class="annotations">
                    <div class="annotation annotation-1">
                        <strong>单元测试</strong>: 针对独立组件和函数的测试，数量最多，运行速度最快，是测试金字塔的基础。
                        <div class="arrow arrow-1"></div>
                    </div>
                    <div class="annotation annotation-2">
                        <strong>集成测试</strong>: 验证多个组件间的协作，确保它们能一起工作，数量适中。
                        <div class="arrow arrow-2"></div>
                    </div>
                    <div class="annotation annotation-3">
                        <strong>端到端测试</strong>: 从用户角度测试完整流程，确保系统符合用户需求，数量较少。
                        <div class="arrow arrow-3"></div>
                    </div>
                    <div class="annotation annotation-4">
                        <strong>性能测试</strong>: 评估系统性能，确保响应时间和资源使用在可接受范围内。
                        <div class="arrow arrow-4"></div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="legend">
            <div class="legend-item">
                <div class="legend-color legend-color-1"></div>
                <span>单元测试 (≥90%)</span>
            </div>
            <div class="legend-item">
                <div class="legend-color legend-color-2"></div>
                <span>集成测试 (≥80%)</span>
            </div>
            <div class="legend-item">
                <div class="legend-color legend-color-3"></div>
                <span>端到端测试 (≥70%)</span>
            </div>
            <div class="legend-item">
                <div class="legend-color legend-color-4"></div>
                <span>性能测试</span>
            </div>
        </div>
        
        <div class="test-structure">
            <h2>测试目录结构</h2>
            <pre style="background:#f5f5f5;padding:15px;border-radius:5px;overflow:auto;">
src/tests/
├── utils/                   # 测试工具类
│   └── test-utils.ts        # 通用测试工具函数
├── mocks/                   # Mock 对象
│   ├── mock-prompt-service.ts
│   └── mock-workflow-service.ts
├── unit/                    # 单元测试
│   ├── services/            # 服务层测试
│   │   ├── prompt-service.test.ts
│   │   └── workflow-service.test.ts
│   ├── ui/                  # UI 组件测试
│   │   ├── tree-view/
│   │   └── webview/         # WebView 组件测试
│   │       ├── flow-state-manager.test.ts
│   │       └── dev-flow-guide-provider.test.ts
│   └── utils.test.ts        # 工具函数测试
├── integration/             # 集成测试
│   ├── services-integration.test.ts
│   └── ui-services-integration.test.ts
├── e2e/                     # 端到端测试
│   └── extension.test.ts
├── performance/             # 性能测试
│   └── webview-performance.test.ts
└── setup.ts                 # 测试环境设置
            </pre>
            
            <div class="modules">
                <div class="module">
                    <h3>服务层测试</h3>
                    <ul>
                        <li>PromptService</li>
                        <li>WorkflowService</li>
                        <li>FlowStepsMappingService</li>
                    </ul>
                    <div class="coverage">目标覆盖率: 90%+</div>
                </div>
                
                <div class="module">
                    <h3>UI组件测试</h3>
                    <ul>
                        <li>FlowStateManager</li>
                        <li>DevFlowGuideProvider</li>
                        <li>HTML生成器</li>
                        <li>TreeView提供者</li>
                    </ul>
                    <div class="coverage">目标覆盖率: 80%+</div>
                </div>
                
                <div class="module">
                    <h3>工具函数测试</h3>
                    <ul>
                        <li>错误处理</li>
                        <li>格式化函数</li>
                        <li>辅助工具</li>
                    </ul>
                    <div class="coverage">目标覆盖率: 90%+</div>
                </div>
                
                <div class="module">
                    <h3>集成测试</h3>
                    <ul>
                        <li>服务协作测试</li>
                        <li>UI-服务集成</li>
                        <li>工作流生命周期</li>
                    </ul>
                    <div class="coverage">关键路径覆盖: 95%+</div>
                </div>
                
                <div class="module">
                    <h3>端到端测试</h3>
                    <ul>
                        <li>扩展激活与注册</li>
                        <li>命令执行</li>
                        <li>完整用户操作流</li>
                    </ul>
                    <div class="coverage">用户场景覆盖: 90%+</div>
                </div>
                
                <div class="module">
                    <h3>性能测试</h3>
                    <ul>
                        <li>HTML渲染性能</li>
                        <li>文件加载优化</li>
                        <li>操作响应时间</li>
                    </ul>
                    <div class="coverage">关键性能指标监控</div>
                </div>
            </div>
        </div>
    </div>
</body>
</html> 